<html>
<meta charset='utf-8'>
<head>
    <script src='https://d3js.org/d3.v7.min.js'></script>
    <style>
        .gridlines .domain {
            stroke: none;
        }
    </style>
</head>
<body>
    <div id='plot1'></div>
    <div id='plot2'></div>
    <div id='plot3'></div>
    <div id='plot4'></div>
    <div id='plot5'></div>
    <div id='plot6'></div>
    <div id='plot7'></div>
    <br>
    <br>
    <div id='plot10'></div>
    <br>
    <br>
    <div id='plot8'></div>
    <br>
    <br>
    <div id='plot9'></div>

    <script>
        let plot1Div = d3.select('#plot1');
        let plot2Div = d3.select('#plot2');
        let plot3Div = d3.select('#plot3');
        let plot4Div = d3.select('#plot4');
        let plot5Div = d3.select('#plot5');
        let plot6Div = d3.select('#plot6');
        let plot7Div = d3.select('#plot7');
        let plot8Div = d3.select('#plot8');
        let plot10Div = d3.select('#plot10');
        let plot9Div = d3.select('#plot9');
        let file = 'mammals.csv';
        let plotWidth = 600;
        let plotHeight = 600;
        let circleRadius = 5;
        let circleOpacity = 0.7;

        let lollipopPlotWidth = 700;
        let lollipopPlotHeight = 700;

        // =================================================================================================
        // #################### Double bar Chart dreaming vs Non Dreaming ##############################
        //==================================================================================================
        // Function in called in the .then()

        // Plot 8 horizontal bar chart
        const render = data => {

        const margin = {left: 500, right: 10, top: 60, bottom: 10}
        const innerWidth = plotWidth - margin.left-margin.right;
        const innerHeight = plotHeight - margin.top-margin.bottom;
        const dreamRange = d3.extent( data, d => d.dreaming);
        const nonDreamRange = d3.extent( data, d => d.non_dreaming);
        const dreamScale = d3.scaleLinear().domain([0, dreamRange[1]]).range([50, 200]);
        const nonDreamScale = d3.scaleLinear().domain([0, nonDreamRange[1]]).range([50, 200]);
        const yScale = d3.scaleBand().domain(data.map(d => d.species)).range([0, innerHeight])

        const svg8 = plot8Div.append('svg')
                             .attr('width', 750)
                             .attr('height', 650)

        const chartArea8 = svg8.append('g')
                               .attr('transform', `translate(${margin.left}, ${margin.top})`);

            // left bar chart
            chartArea8.selectAll("rect.left")
                      .data(data)
                      .enter().append("rect")
                      .attr('transform', `translate(${margin.left - 650})`)
                      .attr("x", d => ( - nonDreamScale(d.non_dreaming)))
                      .attr('y', d => yScale(d.species))
                      .attr("class", "left")
                      .attr('width', d => (nonDreamScale(d.non_dreaming)))
                      .attr('height', yScale.bandwidth())
                      .attr("stroke-width", "1")
                      .attr("stroke", "black")
                      .style("fill", "green")

            // Left Rectangle values
            chartArea8.selectAll("text.leftscore")
                      .data(data)
                      .enter().append("text")
                      .attr("x",  d => (-nonDreamScale(d.non_dreaming) - 30))
                      .attr("y", d => yScale(d.species))
                      .attr("dx", "-132")
                      .attr("dy", ".96em")
                      .attr('font-size', '10px')
                      .attr("text-anchor", "middle")
                      .attr('class', 'leftscore')
                      .attr('font-family', 'arial')
                      .text(d => d['non_dreaming']);

            // right bar chart
            chartArea8.selectAll("rect.right")
                      .data(data)
                      .enter().append("rect")
                      .attr('y', d => yScale(d.species))
                      .attr("class", "right")
                      .attr('width', d =>  dreamScale(d.dreaming))
                      .attr('height', yScale.bandwidth())
                      .style("fill", "#CB4C4E")
                      .attr('text-anchor', 'middle')
                      .attr("stroke-width", "1")
                      .attr("stroke", "black")

            //right Rectangle values
            chartArea8.selectAll("text.rightscore")
                      .data(data)
                      .enter().append("text")
                      .attr("x",  d => (dreamScale(d.dreaming) +20))
                      .attr("y", d => yScale(d.species))
                      .attr("dx", -16)
                      .attr("dy", ".96em")
                      .attr("text-anchor", "center")
                      .attr('font-family', 'arial')
                      .attr('font-size', '10px')
                      .attr('class', 'rightscore')
                      .text(d => d['dreaming']);

            // Dreaming Label
            chartArea8.append("text")
                      .attr("x", 72)
                      .attr("y", -11)
                      .attr("class","title").text("Dreaming(hours)")
                      .attr('text-anchor', 'middle')
                      .attr('dominant-baseline', 'middle')
                      .attr('font-size', '20px')
                      .attr('fill', 'black')
                      .attr('font-family', 'arial');

            // Non-Dreaming Label
            chartArea8.append("text")
                      .attr("x",-245)
                      .attr("y", -11)
                      .attr("class","title").text("Non-Dreaming(hours)")
                      .attr('text-anchor', 'middle')
                      .attr('dominant-baseline', 'middle')
                      .attr('font-size', '20px')
                      .attr('fill', 'black')
                      .attr('font-family', 'arial');

            // Chart titles and labels
            chartArea8.append("text").attr("x",-120).attr("y", -40)
                      .attr("class","title").text("Dreaming vs Non-Dreaming Pattern in Mammals ")
                      .attr('text-anchor', 'middle')
                      .attr('dominant-baseline', 'middle')
                      .attr('font-size', '30px')
                      .attr('fill', 'black')
                      .attr('font-weight', 'bold')
                      .attr('font-family', 'arial');

            // Cleaned species' names to make the plot more legible
            let species = [...new Set(data.map( d => d.species ))];

            let cleanedSpecies = ['African Giant Pouched Rat', 'Asian Elephant', 'Baboon',
                                'Big Brown Bat', 'Brazilian Tapir', 'Cat', 'Chimpanzee',
                                'Chinchilla', 'Cow', 'Eastern American Mole', 'Echidna',
                                'European Hedgehog', 'Galago', 'Goat', 'Golden Hamster',
                                'Gray Seal', 'Ground Squirrel', 'Guinea Pig', 'Horse',
                                'Lesser Short-Tailed Shrew', 'Little Brown Bat', 'Man',
                                'Mouse', 'Muskshrew', 'North American Possum',
                                'Nine-Banded Armadillo', 'Owl Monkey', 'Patas Monkey',
                                'Phalanger', 'Pig', 'Rabbit', 'Rat', 'Red Fox', 'Rhesus Monkey',
                                'Rock Hyrax I', 'Rock Hyrax II', 'Sheep', 'Tenrec',
                                'Tree Hyrax', 'Tree Shrew', 'Vervet', 'Water Opossum'];

            // Create a JSON mapping the dataset species' labels to the cleaned names
            let speciesLabels = {};
            species.forEach( (d, i) => {
                speciesLabels[d] = cleanedSpecies[i];
            })

            // Species name
            chartArea8.selectAll("text.name")
                      .data(data)
                      .enter().append("text")
                      .attr("x", -75)
                      .attr("y", d => yScale(d.species))
                      .attr("dy", ".90em")
                      .attr("text-anchor", "middle")
                      .attr('font-family', 'arial')
                      .attr('font-size', '12px')
                      .attr('class', 'name')
                      .text(d => speciesLabels[d.species]);

            // Figure description/Caption
            chartArea8.append('text')
                      .attr('x', -130)
                      .attr('y', 560)
                      .text('Fig. 3. The double bar chart plot illustrates the relationship between Non-dreaming and dreaming in Mammals.')
                      .attr('text-anchor', 'middle')
                      .attr('dominant-baseline', 'auto')
                      .attr('font-size', '12px')
                      .attr('fill', 'black')
                      .style('font-family', 'arial');

        };
// =================================================================================================
// #################### End of Plot 8 -- Double bar Chart dreaming vs Non Dreaming ################
//==================================================================================================


        d3.csv(file).then( (data) => {
            const svg1 = plot1Div.append('svg')
                                 .attr('width', plotWidth)
                                 .attr('height', plotHeight)
                                 .attr('id', 'svg1')


            const svg9 = plot9Div.append('svg')
                                 .attr('width', lollipopPlotWidth)
                                 .attr('height', lollipopPlotHeight)
                                 .attr('id', 'svg9')

            // slight horizontal translation to prevent text from getting cutoff
            const chartArea9 = svg9.append('g')
                                   .attr('transform', 'translate(5, 50)');

            // Remove NAs
            data = data.filter( d => (d.gestation != "NA" && d.total_sleep != "NA" && d.dreaming != "NA" && d.life_span != "NA" && d.non_dreaming != "NA"))

            // Plot 8 function
            render(data)

            // Convert strings to numbers
            data.forEach( (d) => {

              d.gestation = Number(d.gestation);
              d.total_sleep = Number(d.total_sleep);
              d.brain_wt = Number(d.brain_wt);
              d.body_wt = Number(d.body_wt);
              d.pred = Number(d.predation);
              d.non_dreaming = Number(d.non_dreaming);
              d.dreaming = Number(d.dreaming);
              d.life_span = Number(d.life_span);
            
	        })

            const gesRange = d3.extent( data, d => d.gestation);
            const sleepRange = d3.extent( data, d => d.total_sleep);
            const dreamRange = d3.extent( data, d => d.dreaming);
            const nondreamRange = d3.extent( data, d => d.non_dreaming);

            const maxDream = Math.max(dreamRange[1],nondreamRange[1]);

            const predRange = d3.extent( data, d => d.pred);

            const basicXScale = d3.scaleLinear().domain([0, data.length]).range([5, plotWidth]);
            const dreamScale = d3.scaleLinear().domain([0,maxDream]).range([plotHeight - circleRadius, circleRadius]);
            const percentScale = d3.scaleLinear().domain([0,100]).range([plotHeight - circleRadius, circleRadius]);
  

// =================================================================================================
// #################### Start of Plot 10 -- Box Plot Predation vs Total Sleep
//==================================================================================================
            // svg element for plot 10 (the 3rd final plot)
            const margin3 = {top: 30, right: 50, bottom: 50, left: 50};

            const width3 = plotWidth - margin3.right - margin3.left;
            const height3 = plotHeight - margin3.top - margin3.bottom;

            const svg10 = plot10Div.append('svg')
                                   .attr('width', plotWidth)
                                   .attr('height', plotHeight)
            
            const chartArea10 = svg10.append('g')
                                     .attr('transform', `translate(${margin3.left},${margin3.top})`);

            // Chart title
            chartArea10.append("text")
                       .attr("x", width3/2)
                       .attr("y", - margin3.top)
                       .attr("class","title").text("Total Sleep by Predation Level")
                       .attr('text-anchor', 'middle')
                       .attr('dominant-baseline', 'hanging')
                       .attr('font-size', '30px')
                       .attr('fill', 'black')
                       .attr('font-weight', 'bold')
                       .attr('font-family', 'arial');

            // Legend header
            chartArea10.append("text")
                       .attr("x", width3 - 50)
                       .attr("y", 20)
                       .text('Predation')
                       .attr('text-anchor', 'start')
                       .attr('dominant-baseline', 'hanging')
                       .attr('font-size', '20px')
                       .attr('fill', 'black')
                       .attr('font-weight', 'bold')
                       .attr('font-family', 'arial');

            // Legend color 1
            chartArea10.append("rect")
                       .attr("x", width3 - 50 )
                       .attr("y", 48 )
                       .attr("height", 12 )
                       .attr("width", 12 )
                       .style("fill", "green")

            chartArea10.append("text")
                       .attr("x", width3 - 30)
                       .attr("y", 50)
                       .text('1')
                       .attr('text-anchor', 'start')
                       .attr('dominant-baseline', 'hanging')
                       .attr('font-size', '12px')
                       .attr('fill', 'black')
                       .attr('font-family', 'arial');

            // Legend color 2
            chartArea10.append("rect")
                       .attr("x", width3 - 50 )
                       .attr("y", 68 )
                       .attr("height", 12 )
                       .attr("width", 12 )
                       .style("fill", "gold")

            chartArea10.append("text")
                       .attr("x", width3 - 30)
                       .attr("y", 70)
                       .text('2')
                       .attr('text-anchor', 'start')
                       .attr('dominant-baseline', 'hanging')
                       .attr('font-size', '12px')
                       .attr('fill', 'black')
                       .attr('font-family', 'arial');

            // Legend color 3
            chartArea10.append("rect")
                       .attr("x", width3 - 50 )
                       .attr("y", 88 )
                       .attr("height", 12 )
                       .attr("width", 12 )
                       .style("fill", "orange")

            chartArea10.append("text")
                       .attr("x", width3 - 30)
                       .attr("y", 90)
                       .text('3')
                       .attr('text-anchor', 'start')
                       .attr('dominant-baseline', 'hanging')
                       .attr('font-size', '12px')
                       .attr('fill', 'black')
                       .attr('font-family', 'arial');

            // Legend color 4
            chartArea10.append("rect")
                       .attr("x", width3 - 50 )
                       .attr("y", 108 )
                       .attr("height", 12 )
                       .attr("width", 12 )
                       .style("fill", "red")

            chartArea10.append("text")
                       .attr("x", width3 - 30)
                       .attr("y", 110)
                       .text('4')
                       .attr('text-anchor', 'start')
                       .attr('dominant-baseline', 'hanging')
                       .attr('font-size', '12px')
                       .attr('fill', 'black')
                       .attr('font-family', 'arial');

            // Legend color 5
            chartArea10.append("rect")
                       .attr("x", width3 - 50 )
                       .attr("y", 128 )
                       .attr("height", 12 )
                       .attr("width", 12 )
                       .style("fill", "grey")

            chartArea10.append("text")
                       .attr("x", width3 - 30)
                       .attr("y", 130)
                       .text('5')
                       .attr('text-anchor', 'start')
                       .attr('dominant-baseline', 'hanging')
                       .attr('font-size', '12px')
                       .attr('fill', 'black')
                       .attr('font-family', 'arial');

            // X-axis label
            chartArea10.append("text")
                       .attr("x", width3/2 - 25)
                       .attr("y", height3 + 20)
                       .text('Predation')
                       .attr('text-anchor', 'middle')
                       .attr('dominant-baseline', 'hanging')
                       .attr('font-size', '20px')
                       .attr('fill', 'black')
                       .attr('font-weight', 'bold')
                       .attr('font-family', 'arial');

            // Y-axis label
            chartArea10.append('text')
                       .attr('x', 130)
                       .attr('y', height3/2 -15)
                       .text('Total Sleep')
                       .attr('text-align', 'middle')
                       .attr('font-size', '20px')
                       .attr('fill', 'black')
                       .attr('transform', 'rotate(-90,30,' + plotHeight/2 + ')')
                       .style('font-family', 'arial')

            // Figure description
            chartArea10.append('text')
                       .attr('class', 'boxplot-description')
                       .attr('x', width3/2)
                       .attr('y', height3+margin3.bottom)
                       .text('Fig. 2. This box plot analyzes the total sleep for mammals in each of the 5 predation levels of the dataset.')
                       .attr('text-anchor', 'middle')
                       .attr('dominant-baseline', 'auto')
                       .attr('font-size', '12px')
                       .attr('fill', 'black')
                       .style('font-family', 'arial');

            // Show the Y scale
            var y_p10 = d3.scaleLinear()
                          .domain([-10,25])
                          .range([height3, 5]);
            
            chartArea10.call(d3.axisLeft(y_p10))

            // Show the X scale
            var x_p10 = d3.scaleLinear()
                          .domain([1,5])
                          .range([50, width3-100]);
            
            chartArea10.append("g")
                       .attr("transform", `translate(${0}, ${height3})`)
                       .call(d3.axisBottom(x_p10))

            // Box variable
            var box_width = x_p10(2.5) - x_p10(2.0)

            // BOX 1 //////////////////////////////////////////////////////////

            // Summary statistics for box 1:
            var pred1 = data.filter( d => (d.pred == 1));
            var pred1_filtered = [...new Set(pred1.map( d => d.total_sleep ))];
            var pred1_sorted = pred1_filtered.sort(d3.ascending);
            var pred1_q1 = d3.quantile(pred1_sorted, .25);
            var pred1_median = d3.quantile(pred1_sorted, .5);
            var pred1_q3 = d3.quantile(pred1_sorted, .75);
            var pred1_interQuantileRange = pred1_q3 - pred1_q1;
            var pred1_min = pred1_q1 - 1.5 * pred1_interQuantileRange;
            var pred1_max = pred1_q1 + 1.5 * pred1_interQuantileRange;

            // Show the main vertical line for box 1
            chartArea10.append("line")
                       .attr("x1", x_p10(1))
                       .attr("x2", x_p10(1))
                       .attr("y1", y_p10(pred1_min) )
                       .attr("y2", y_p10(pred1_max) )
                       .attr("stroke", "black")

            // Show box 1
            chartArea10.append("rect")
                       .attr("x", x_p10(0.75) )
                       .attr("y", y_p10(pred1_q3) )
                       .attr("height", y_p10(pred1_q1) - y_p10(pred1_q3) )
                       .attr("width", box_width )
                       .attr("stroke", "black")
                       .style("fill", "green")

            // Show the median, min and max horizontal lines for box 1
            chartArea10.selectAll("toto")
                       .data([pred1_min,pred1_median, pred1_max])
                       .enter()
                       .append("line")
                       .attr("x1", x_p10(0.75))
                       .attr("x2", x_p10(1.25))
                       .attr("y1", function(d){ return(y_p10(d))} )
                       .attr("y2", function(d){ return(y_p10(d))} )
                       .attr("stroke", "black")

            // BOX 2 //////////////////////////////////////////////////////////

            // Summary statistics for box 2:
            var pred2 = data.filter( d => (d.pred == 2));
            var pred2_filtered = [...new Set(pred2.map( d => d.total_sleep ))];
            var pred2_sorted = pred2_filtered.sort(d3.ascending);
            var pred2_q1 = d3.quantile(pred2_sorted, .25);
            var pred2_median = d3.quantile(pred2_sorted, .5);
            var pred2_q3 = d3.quantile(pred2_sorted, .75);
            var pred2_interQuantileRange = pred2_q3 - pred2_q1;
            var pred2_min = pred2_q1 - 1.5 * pred2_interQuantileRange;
            var pred2_max = pred2_q1 + 1.5 * pred2_interQuantileRange;

            // Show the main vertical line for box 2
            chartArea10.append("line")
                       .attr("x1", x_p10(2))
                       .attr("x2", x_p10(2))
                       .attr("y1", y_p10(pred2_min) )
                       .attr("y2", y_p10(pred2_max) )
                       .attr("stroke", "black")

            // Show box 2
            chartArea10.append("rect")
                       .attr("x", x_p10(1.75) )
                       .attr("y", y_p10(pred2_q3) )
                       .attr("height", y_p10(pred2_q1) - y_p10(pred2_q3) )
                       .attr("width", box_width )
                       .attr("stroke", "black")
                       .style("fill", "gold")

            // Show the median, min and max horizontal lines for box 2
            chartArea10.selectAll("toto")
                       .data([pred2_min,pred2_median, pred2_max])
                       .enter()
                       .append("line")
                       .attr("x1", x_p10(1.75))
                       .attr("x2", x_p10(2.25))
                       .attr("y1", function(d){ return(y_p10(d))} )
                       .attr("y2", function(d){ return(y_p10(d))} )
                       .attr("stroke", "black")

            // BOX 3 //////////////////////////////////////////////////////////

            // Summary statistics for box 3:
            var pred3 = data.filter( d => (d.pred == 3));
            var pred3_filtered = [...new Set(pred3.map( d => d.total_sleep ))];
            var pred3_sorted = pred3_filtered.sort(d3.ascending);
            var pred3_q1 = d3.quantile(pred3_sorted, .25);
            var pred3_median = d3.quantile(pred3_sorted, .5);
            var pred3_q3 = d3.quantile(pred3_sorted, .75);
            var pred3_interQuantileRange = pred3_q3 - pred3_q1;
            var pred3_min = pred3_q1 - 1.5 * pred3_interQuantileRange;
            var pred3_max = pred3_q1 + 1.5 * pred3_interQuantileRange;

            // Show the main vertical line for box 3
            chartArea10.append("line")
                       .attr("x1", x_p10(3))
                       .attr("x2", x_p10(3))
                       .attr("y1", y_p10(pred3_min) )
                       .attr("y2", y_p10(pred3_max) )
                       .attr("stroke", "black")

            // Show box 3
            chartArea10.append("rect")
                       .attr("x", x_p10(2.75) )
                       .attr("y", y_p10(pred3_q3) )
                       .attr("height", y_p10(pred3_q1) - y_p10(pred3_q3) )
                       .attr("width", box_width )
                       .attr("stroke", "black")
                       .style("fill", "orange")

            // Show the median, min and max horizontal lines for box 3
            chartArea10.selectAll("toto")
                       .data([pred3_min,pred3_median, pred3_max])
                       .enter()
                       .append("line")
                       .attr("x1", x_p10(2.75))
                       .attr("x2", x_p10(3.25))
                       .attr("y1", function(d){ return(y_p10(d))} )
                       .attr("y2", function(d){ return(y_p10(d))} )
                       .attr("stroke", "black")

            // BOX 4 //////////////////////////////////////////////////////////

            // Summary statistics for box 4:
            var pred4 = data.filter( d => (d.pred == 4));
            var pred4_filtered = [...new Set(pred4.map( d => d.total_sleep ))];
            var pred4_sorted = pred4_filtered.sort(d3.ascending);
            var pred4_q1 = d3.quantile(pred4_sorted, .25);
            var pred4_median = d3.quantile(pred4_sorted, .5);
            var pred4_q3 = d3.quantile(pred4_sorted, .75);
            var pred4_interQuantileRange = pred4_q3 - pred4_q1;
            var pred4_min = pred4_q1 - 1.5 * pred4_interQuantileRange;
            var pred4_max = pred4_q1 + 1.5 * pred4_interQuantileRange;

            // Show the main vertical line for box 4
            chartArea10.append("line")
                       .attr("x1", x_p10(4))
                       .attr("x2", x_p10(4))
                       .attr("y1", y_p10(pred4_min) )
                       .attr("y2", y_p10(pred4_max) )
                       .attr("stroke", "black")

            // Show box 4
            chartArea10.append("rect")
                       .attr("x", x_p10(3.75) )
                       .attr("y", y_p10(pred4_q3) )
                       .attr("height", y_p10(pred4_q1) - y_p10(pred4_q3) )
                       .attr("width", box_width )
                       .attr("stroke", "black")
                       .style("fill", "red")

            // Show the median, min and max horizontal lines for box 4
            chartArea10.selectAll("toto")
                       .data([pred4_min,pred4_median, pred4_max])
                       .enter()
                       .append("line")
                       .attr("x1", x_p10(3.75))
                       .attr("x2", x_p10(4.25))
                       .attr("y1", function(d){ return(y_p10(d))} )
                       .attr("y2", function(d){ return(y_p10(d))} )
                       .attr("stroke", "black")

            // BOX 5 //////////////////////////////////////////////////////////

            // Summary statistics for box 5:
            var pred5 = data.filter( d => (d.pred == 5));
            var pred5_filtered = [...new Set(pred5.map( d => d.total_sleep ))];
            var pred5_sorted = pred5_filtered.sort(d3.ascending);
            var pred5_q1 = d3.quantile(pred5_sorted, .25);
            var pred5_median = d3.quantile(pred5_sorted, .5);
            var pred5_q3 = d3.quantile(pred5_sorted, .75);
            var pred5_interQuantileRange = pred5_q3 - pred5_q1;
            var pred5_min = pred5_q1 - 1.5 * pred5_interQuantileRange;
            var pred5_max = pred5_q1 + 1.5 * pred5_interQuantileRange;

            // Show the main vertical line for box 5
            chartArea10.append("line")
                       .attr("x1", x_p10(5))
                       .attr("x2", x_p10(5))
                       .attr("y1", y_p10(pred5_min) )
                       .attr("y2", y_p10(pred5_max) )
                       .attr("stroke", "black")

            // Show box 5
            chartArea10.append("rect")
                       .attr("x", x_p10(4.75) )
                       .attr("y", y_p10(pred5_q3) )
                       .attr("height", y_p10(pred5_q1) - y_p10(pred5_q3) )
                       .attr("width", box_width )
                       .attr("stroke", "black")
                       .style("fill", "grey")

            // Show the median, min and max horizontal lines for box 1
            chartArea10.selectAll("toto")
                       .data([pred5_min,pred5_median, pred5_max])
                       .enter()
                       .append("line")
                       .attr("x1", x_p10(4.75))
                       .attr("x2", x_p10(5.25))
                       .attr("y1", function(d){ return(y_p10(d))} )
                       .attr("y2", function(d){ return(y_p10(d))} )
                       .attr("stroke", "black")


// =================================================================================================
// #################### End of Plot 10 -- Box Plot Predation vs Total Sleep
//==================================================================================================


            // svg 1
            let allPredation = data.map( d => d.pred );
            let uniquePred = [...new Set(allPredation)];

            const margin = {left: 50, right: 10, top: 10, bottom: 50}
            const padding = {bottom: 50, top: 50}
            const gesScale = d3.scaleLinear().domain(gesRange).range([50, plotWidth]);
            const sleepScale = d3.scaleLinear().domain(sleepRange).range([plotHeight - padding.bottom - margin.bottom, padding.top]);

            let colors = ["green", "gold", "orange", "red" ,"grey"];
            const colorScale = d3.scaleOrdinal(colors).domain([1,2,3,4,5])

            const chartArea1 = svg1.append('g')
                                   .attr('transform', `translate(${margin.left}, ${margin.top})`)

            let title1 = svg1.append('text')
                             .text("Length of Gestation vs Sleep in Mammals")
                             .attr('x', plotWidth/2 + 4)
                             .attr('y', 10)
                             .attr('text-anchor', 'middle')
                             .attr('dominant-baseline', 'hanging')
                             .attr('font-size', '30px')
                             .attr('fill', 'black')
                             .style('font-family','arial')
                             .style('font-weight','bold')

            let caption1 = svg1.append('text')
                               .text("Fig. 1. This plot shows the relation between the length of gestation and sleep for mammals of the dataset.")
                               .attr('x', plotWidth/2 + 20)
                               .attr('y', plotHeight-3)
                               .attr('text-anchor', 'middle')
                               .attr('dominant-baseline', 'auto')
                               .attr('font-size', '12px')
                               .attr('fill', 'black')
                               .style('font-family','arial')

            let bottomAxis = d3.axisBottom(gesScale);
            let bottomAxisGroup = svg1.append('g')
                                      .attr('class', 'x axis')
                                      .attr('id', 'plot1-xaxis')
                                      .attr('transform', `translate(${margin.left}, ${plotHeight - margin.top - margin.bottom - 10})`)
                                      .call(bottomAxis)

            let bottomAxisText = bottomAxisGroup.append('text')
                                                .text('Gestation (days)')
                                                .attr('x', plotWidth/2)
                                                .attr('y', padding.bottom - 8)
                                                .attr('text-align', 'middle')
                                                .attr('font-size', '20px')
                                                .attr('fill', 'black')

            let leftAxis = d3.axisLeft(sleepScale);
            let leftAxisGroup = svg1.append('g')
                                    .attr('class', 'y axis')
                                    .attr('id', 'plot1-yaxis')
                                    .attr('transform', `translate(${margin.left+20}, ${margin.top})`)
                                    .call(leftAxis)

            let leftAxisText = svg1.append('text')
                                   .text('Sleep (hrs)')
                                   .attr('x', 30)
                                   .attr('y', plotHeight/2)
                                   .attr('text-align', 'middle')
                                   .attr('font-size', '20px')
                                   .attr('fill', 'black')
                                   .attr('transform', 'rotate(-90,30,' + plotHeight/2 + ')')
                                   .style('font-family', 'arial')

            // Reference: https://www.d3indepth.com/shapes/
            let symbolCreator = d3.symbol().size(100);
            let symbolTypes = ['symbolCircle', 'symbolDiamond', 'symbolSquare', 'symbolStar', 'symbolTriangle']
            let symbols = chartArea1.selectAll('path')
                                    .data(data)
                                    .join('path')
                                    .attr('id', 'svg1data')
                                    .attr('transform', d => `translate(${gesScale(d.gestation)}, ${sleepScale(d.total_sleep)})`)
                                    .attr('d', function(d) {
                                        symbolCreator.type(d3[symbolTypes[d.pred-1]]); // account for array indexing
                                        return symbolCreator();
                                    })
                                    .style('fill', d => colors[d.pred-1])

            chartArea1.append('rect')
                    .attr('x', plotWidth/2 + 100)
                    .attr('y', margin.top + padding.top - 8)
                    .attr('height', 165)
                    .attr('width', 125)
                    .style('fill', 'white')
                    .style('stroke', 'lightgrey')
                    .style('stroke-width', 1)

            let predation = [1, 2, 3, 4, 5];
            predation.forEach( (d, i) => {
                chartArea1.append('path')
                          .attr('transform', d => `translate(${plotWidth - 175}, ${20 + margin.top + padding.top + 20 + i * 25})`)
                          .attr('d', function(d) {
                                        symbolCreator.type(d3[symbolTypes[i]]);
                                        return symbolCreator();
                          })
                          .style('fill', d => colors[i]) // account for predation ranging from 1 to 5

                chartArea1.append('text')
                          .attr('transform', d => `translate(${plotWidth - 160}, ${20+ margin.top + padding.top + 24 + i * 25})`)
                          .text(() => {if (i == 0) {return (i+1) + " - safe"} else if (i == 4) {return (i+1) + " - dangerous"} else {return (i+1)}})
                          .style('font-family', 'arial')
                          .attr('font-size', '12px')
            })

            // Legend header
            chartArea1.append('text')
                      .attr('transform', d => `translate(${plotWidth - 182}, ${20+ margin.top + padding.top})`)
                      .style('font-family', 'arial')
                      .text('Predation')
                      .attr('font-size', '20px')
                      .attr('font-weight', 'bold')

            // Chart 9 -- lollipop chart code adapted from the lecture code
            // Left - body
            // Right - brain

            // Title
            let medianLifeSpanColors = ['#f54e42', 'green'];

            chartArea9.append('text')
                      .attr('class', 'lollipop-title')
                      .attr('x', lollipopPlotWidth/2)
                      .attr('y', -20)
                      .text('Mammal Body and Brain Weight Distributions')
                      .attr('text-anchor', 'middle')
                      .attr('dominant-baseline', 'middle')
                      .attr('font-size', '30px')
                      .attr('fill', 'black')
                      .attr('font-weight', 'bold')
                      .style('font-family', 'arial')

            // Two section headers
            chartArea9.append('text')
                      .attr('class', 'lollipop-section1')
                      .attr('x', lollipopPlotWidth/2 - 20)
                      .attr('y', 10)
                      .text('Body Weight (kg)')
                      .attr('text-anchor', 'end')
                      .attr('dominant-baseline', 'middle')
                      .attr('font-size', '20px')
                      .attr('fill', 'black')
                      .style('font-family', 'arial')

            chartArea9.append('text')
                      .attr('class', 'lollipop-section2')
                      .attr('x', lollipopPlotWidth/2 + 20)
                      .attr('y', 10)
                      .text('Brain Weight (kg)')
                      .attr('text-anchor', 'start')
                      .attr('dominant-baseline', 'middle')
                      .attr('font-size', '20px')
                      .attr('fill', 'black')
                      .style('font-family', 'arial')

            // Figure description
            chartArea9.append('text')
                      .attr('class', 'lollipop-description')
                      .attr('x', lollipopPlotWidth/2)
                      .attr('y', lollipopPlotHeight - 70)
                      .text('Fig. 4. This plot shows the body and brain weight distributions for a  ' +
                            '22 mammal subset of the dataset.')
                      .attr('text-anchor', 'middle')
                      .attr('dominant-baseline', 'middle')
                      .attr('font-size', '12px')
                      .attr('fill', 'black')
                      .style('font-family', 'arial')

            // Outer rectangle
            chartArea9.append('rect')
                      .attr('x', lollipopPlotWidth/2 - 200)
                      .attr('y', 20)
                      .attr('height', lollipopPlotHeight - 105)
                      .attr('width', 400)
                      .style('fill', 'white')
                      .style('stroke', '#ccc')
                      .style('stroke-width', 1)

            // Legend
            chartArea9.append('text')
                      .attr('x', lollipopPlotWidth - 75)
                      .attr('y', 28)
                      .text('Legend')
                      .attr('text-anchor', 'middle')
                      .attr('dominant-baseline', 'middle')
                      .attr('font-size', '18px')
                      .attr('fill', 'black')
                      .attr('font-weight', 'bold')
                      .style('font-family', 'arial')

            chartArea9.append('rect')
                      .attr('x', lollipopPlotWidth - 140)
                      .attr('y', 50)
                      .attr('height', 20)
                      .attr('width', 20)
                      .style('fill', medianLifeSpanColors[1])

            chartArea9.append('text')
                      .attr('x', lollipopPlotWidth - 60)
                      .attr('y', 60)
                      .text('> Median Life Span')
                      .attr('text-anchor', 'middle')
                      .attr('dominant-baseline', 'middle')
                      .attr('font-size', '13px')
                      .attr('fill', 'black')
                      .style('font-family', 'arial')

            chartArea9.append('rect')
                      .attr('x', lollipopPlotWidth - 140)
                      .attr('y', 80)
                      .attr('height', 20)
                      .attr('width', 20)
                      .style('fill', medianLifeSpanColors[0])

            chartArea9.append('text')
                      .attr('x', lollipopPlotWidth - 60)
                      .attr('y', 92)
                      .text('< Median Life Span')
                      .attr('text-anchor', 'middle')
                      .attr('dominant-baseline', 'middle')
                      .attr('font-size', '13px')
                      .attr('fill', 'black')
                      .style('font-family', 'arial')


            let brainSorted = data.sort( (a,b) =>  d3.ascending(a.brain_wt, b.brain_wt) );
            let data2 = brainSorted.slice(0,-10); // Remove 10 largest brain weights
            let bodySorted = data2.sort( (a,b) =>  d3.descending(a.body_wt, b.body_wt) );
            let data3 = bodySorted.slice(0, -10); // Remove 10 smallest body weights

            const brweightRange = d3.extent( data3, d => d.brain_wt);
            const boweightRange = d3.extent( data3, d => d.body_wt);

            let speciesSubset = [];
            data3.forEach( (d) => {
                speciesSubset.push(d.species);
            })

            // Log cause there are some relatively large values
            // Linear makes many of the lines extremely small
            // Tradeoff with the exponential jump near the bottom of the plot (length increase is not intuitive)
            const bodyWeightScale = d3.scaleLog().domain(boweightRange).range([lollipopPlotWidth/2, 200]);
            const brainWeightScale = d3.scaleLog().domain(brweightRange).range([lollipopPlotWidth/2, lollipopPlotWidth - 200]);

            let medianLifeSpan = d3.median(data, d => d.life_span); // use the entire dataset to calculate the median

            let species = [...new Set(data3.map( d => d.species ))]; // use data subset

            // Cleaned species' names to make the plot more legible
            let cleanedSpecies = ['Rat', 'Chinchilla', 'Owl Monkey', 'Rock Hyrax I', 'European Hedgehog',
                           'Tenrec', 'African Giant Pouched Rat', 'Guinea Pig', 'Phalanger',
                           'North American Possum', 'Tree Hyrax', 'Rabbit', 'Echidna',
                           'Cat', 'Nine-Banded Armadillo', 'Water Opossum', 'Rock Hyrax II',
                           'Vervet', 'Red Fox', 'Patas Monkey', 'Goat', 'Brazilian Tapir'].reverse();

            // Create a JSON mapping the dataset species' labels to the cleaned names
            let speciesLabels = {};
            species.forEach( (d, i) => {
                speciesLabels[d] = cleanedSpecies[i];
            })

            const speciesScale = d3.scalePoint().domain(species).range([lollipopPlotHeight - 400, 20]);

            const lifeSpanRange = d3.extent( data, d => d.life_span);
            //const lollipopColorScale = d3.scaleDiverging().domain([lifeSpanRange[0], medianLifeSpan, lifeSpanRange[1]]).range(['red', 'black', 'green']);

            let lollipops = chartArea9.selectAll('g.lollipop').data( data3, d => d.species)
							.join('g')
							.attr('class', 'lollipop')
							.attr('transform', d => `translate(0,${speciesScale(d.species)})`);

            let lollipops2 = chartArea9.selectAll('g.lollipop2').data( data3, d => d.species)
							.join('g')
							.attr('class', 'lollipop2')
							.attr('transform', d => `translate(0,${speciesScale(d.species)})`);

            // Middle
            chartArea9.append('line')
                .attr('x1', lollipopPlotWidth/2)
                .attr('x2', lollipopPlotWidth/2)
                .attr('y1', 20)
                .attr('y2', lollipopPlotHeight - 100)
                .attr('stroke', 'black')

            // Left half: body weight
            lollipops.append('line')
                .attr('class', 'stick')
                .attr('x1', lollipopPlotWidth/2)
                .attr('x2', d => bodyWeightScale(d.body_wt))
                .attr('y1', d => speciesScale(d.species))
                .attr('y2', d => speciesScale(d.species))
                .attr('stroke', d => medianLifeSpanColors[Number(d.life_span > medianLifeSpan)]) // green if above median life span, otherwise red
                .attr('stroke-width', 1)

            // Right half: brain weight
            lollipops2.append('line')
                .attr('class', 'stick')
                .attr('x1', lollipopPlotWidth/2)
                .attr('x2', d => brainWeightScale(d.brain_wt))
                .attr('y1', d => speciesScale(d.species))
                .attr('y2', d => speciesScale(d.species))
                .attr('stroke', d => medianLifeSpanColors[Number(d.life_span > medianLifeSpan)])
                .attr('stroke-width', 1)

            lollipops.append('circle')
                .attr('class', 'pop')
                .attr('r', circleRadius)
                .attr('cx', d => bodyWeightScale(d.body_wt))
                .attr('cy', d => speciesScale(d.species))
                .attr('fill', d => medianLifeSpanColors[Number(d.life_span > medianLifeSpan)])

            lollipops2.append('circle')
                .attr('class', 'pop2')
                .attr('r', circleRadius)
                .attr('cx', d => brainWeightScale(d.brain_wt))
                .attr('cy', d => speciesScale(d.species))
                .attr('fill', d => medianLifeSpanColors[Number(d.life_span > medianLifeSpan)])

            // Add text
            let leftText = lollipops.append('text')
                     .attr('class', 'lollipop-text')
                     .attr('x', d => bodyWeightScale(d.body_wt) - 7)
                     .attr('y', d => speciesScale(d.species))
                     .text(d => d.body_wt)
                     .attr('text-anchor', 'end')
                     .attr('dominant-baseline', 'middle')
                     .attr('font-size', '13px')
                     .attr('fill', 'black')
                     .style('font-family', 'arial')

            lollipops2.append('text')
                      .attr('class', 'lollipip-text')
                      .attr('x', d => brainWeightScale(d.brain_wt) + 7)
                      .attr('y', d => speciesScale(d.species))
                      .text(d => d.brain_wt)
                      .attr('text-anchor', 'start')
                      .attr('dominant-baseline', 'middle')
                      .attr('font-size', '13px')
                      .attr('fill', 'black')
                      .style('font-family', 'arial')

            lollipops.append('text')
                     .attr('class', 'species-text')
                     .attr('x', 140)
                     .attr('y', d => speciesScale(d.species))
                     .text(d => speciesLabels[d.species]) // referened the JSON for the cleaned species' names
                     .attr('text-anchor', 'end')
                     .attr('dominant-baseline', 'middle')
                     .attr('font-size', '12px')
                     .attr('fill', 'black')
                     .style('font-family', 'arial')
        });

    </script>
</body>
</html>
