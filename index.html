<html>
<meta charset='utf-8'>
<head>
    <script src='https://d3js.org/d3.v7.min.js'></script>
    <style>
        .gridlines .domain {
            stroke: none;
        }
    </style>
</head>
<body>
    <div id='plot1'></div>
    <br>
    <div id='plot2'></div>
    <br>
    <div id='plot3'></div>
    <br>
    <div id='plot4'></div>
    <br>
    <div id='plot5'></div>
    <br>
    <div id='plot6'></div>
    <br>
    <div id='plot7'></div>
    <br>
    <div id='plot8'></div>

    <script>
        let plot1Div = d3.select('#plot1');
        let plot2Div = d3.select('#plot2');
        let plot3Div = d3.select('#plot3');
        let plot4Div = d3.select('#plot4');
        let plot5Div = d3.select('#plot5');
        let plot6Div = d3.select('#plot6');
        let plot7Div = d3.select('#plot7');
        let plot8Div = d3.select('#plot8');
        let file = 'mammals.csv';
        let plotWidth = 500;
        let plotHeight = 500;
        let circleRadius = 5;
        let circleOpacity = 0.7;

        d3.csv(file).then( (data) => {
            const svg = plot1Div.append('svg')
                            .attr('width', plotWidth)
                            .attr('height', plotHeight)
                            .style('border', '1px solid black')
            const chartArea = svg.append('g');

            const svg2 = plot2Div.append('svg')
                            .attr('width', plotWidth)
                            .attr('height', plotHeight)
                            .style('border', '1px solid black')
            const chartArea2 = svg2.append('g');

            const svg3 = plot3Div.append('svg')
                            .attr('width', plotWidth)
                            .attr('height', plotHeight)
                            .style('border', '1px solid black')
            const brainSleep = svg3.append('g');

            const svg4 = plot4Div.append('svg')
                            .attr('width', plotWidth)
                            .attr('height', plotHeight)
                            .style('border', '1px solid black')
            const brainDream = svg4.append('g');

            const svg5 = plot5Div.append('svg')
                            .attr('width', plotWidth)
                            .attr('height', plotHeight)
                            .style('border', '1px solid black')
            const chartArea5 = svg5.append('g');

            const svg6 = plot6Div.append('svg')
                            .attr('width', plotWidth)
                            .attr('height', plotHeight)
                            .style('border', '1px solid black')
            const chartArea6 = svg6.append('g');

            const svg7 = plot7Div.append('svg')
                            .attr('width', plotWidth)
                            .attr('height', plotHeight)
                            .style('border', '1px solid black')
            const chartArea7 = svg7.append('g');

            const svg8 = plot8Div.append('svg')
                            .attr('width', plotWidth)
                            .attr('height', plotHeight)
                            .style('border', '1px solid black')
            const chartArea8 = svg8.append('g');


            // Remove NAs
            data = data.filter( d => (d.gestation != "NA" && d.total_sleep != "NA" && d.dreaming != "NA" && d.life_span != "NA"))

            // Convert strings to numbers
            data.forEach( (d) => {
		        d.gestation = Number(d.gestation);
                d.total_sleep = Number(d.total_sleep);
                d.brain_wt = Number(d.brain_wt);
                d.body_wt = Number(d.body_wt);
                d.pred = Number(d.predation);
                d.non_dreaming = Number(d.non_dreaming);
                d.dreaming = Number(d.dreaming);
	        })

            console.log(data);
            console.log(data[0].brain_wt)
            const gesRange = d3.extent( data, d => d.gestation);
            const sleepRange = d3.extent( data, d => d.total_sleep);
            const brweightRange = d3.extent( data, d => d.brain_wt);
            const boweightRange = d3.extent( data, d => d.body_wt);
            const dreamRange = d3.extent( data, d => d.dreaming);
            const nondreamRange = d3.extent( data, d => d.non_dreaming);

            const maxDream = Math.max(dreamRange[1],nondreamRange[1]);

            const predRange = d3.extent( data, d => d.pred);
            console.log(gesRange);
            console.log(sleepRange);
            console.log(brweightRange);
            console.log(boweightRange);
            console.log(predRange);


            const bodyWeightScale = d3.scaleLinear().domain(brweightRange).range([circleRadius, plotWidth - circleRadius]);
            const gesScale = d3.scaleLinear().domain(gesRange).range([circleRadius, plotWidth - circleRadius]);
            const sleepScale = d3.scaleLinear().domain(sleepRange).range([plotHeight - circleRadius, circleRadius]);
            const colorScale = d3.scaleLinear().domain(predRange).range(['#E41A1C', '#4DAF4A']).interpolate(d3.interpolateHcl);
            const basicXScale = d3.scaleLinear().domain([0, data.length]).range([0, plotWidth]);
            const brainScale = d3.scaleLinear().domain([brweightRange[0],680]).range([circleRadius, plotWidth - circleRadius]);
            const dreamScale = d3.scaleLinear().domain([0,maxDream]).range([plotHeight - circleRadius, circleRadius]);
            const percentScale = d3.scaleLinear().domain([0,100]).range([plotHeight - circleRadius, circleRadius]);

            // let lineGen = d3.line()


            data.forEach( (d, i) => {
                // Gestation vs. total_sleep, stratified by predation
                chartArea.append('circle')
                         .attr('cx', gesScale(d.gestation))
                         .attr('cy', sleepScale(d.total_sleep))
                         .attr('r', circleRadius)
                         .attr('opacity', circleOpacity)
                         .attr('index', i)
                         .style('fill', colorScale(d.pred))

                //
                chartArea2.append('rect')
                          .attr('x', basicXScale(i))
                          .attr('y', plotHeight - gesScale(d.gestation))
                          .attr('height', gesScale(d.gestation))
                          .attr('width', plotWidth/data.length)
                          .style('fill', colorScale(d.pred))

                if (d.brain_wt < 700) {
                    brainSleep.append('circle')
                            .attr('cx', brainScale(d.brain_wt))
                            .attr('cy', sleepScale(d.total_sleep))
                            .attr('r', circleRadius)
                            .attr('index', i)
                            .style('fill', 'indigo')
                }

                brainDream.append('circle')
                            .attr('cx', brainScale(d.brain_wt))
                            .attr('cy', dreamScale(d.dreaming))
                            .attr('r', circleRadius)
                            .attr('index', i)
                            .style('fill', 'orange')

                brainDream.append('circle')
                            .attr('cx', brainScale(d.brain_wt))
                            .attr('cy', dreamScale(d.non_dreaming))
                            .attr('r', circleRadius)
                            .attr('index', i)
                            .style('fill', 'indigo')

                // brain weight vs the percentage of time a mammal spends sleeping in their life.
                // curious if mammals that have a certain brain weight will spend more of their life sleeping
                let percentSleepLife = ((365*d.life_span*d.total_sleep)/(d.life_span*24*365))*100;
                chartArea5.append('circle')
                        .attr('cx', brainScale(d.brain_wt))
                        .attr('cy', percentScale(percentSleepLife))
                        .attr('r', circleRadius)
                        .attr('opacity', 0.4)
                        .attr('index', i)
                        .style('fill', 'blue')

                // weight vs the percentage of time a mammal spends dreaming while they sleep
                let percentDreamSleep = (d.dreaming/d.total_sleep)*100;
                chartArea6.append('circle')
                        .attr('cx', brainScale(d.brain_wt))
                        .attr('cy', percentScale(percentDreamSleep))
                        .attr('r', circleRadius)
                        .attr('opacity', 0.4)
                        .attr('index', i)
                        .style('fill', 'purple')

                chartArea7.append('circle')
                        .attr('cx', bodyWeightScale(d.body_wt))
                        .attr('cy', sleepScale(d.total_sleep))
                        .attr('r', circleRadius)
                        .attr('opacity', 0.4)
                        .attr('index', i)
                        .style('fill', colorScale(d.pred))

                chartArea8.append('rect')
                        .attr('x', gesScale(d.gestation))
                        .attr('y', plotHeight - bodyWeightScale(d.body_wt))
                        .attr('height', bodyWeightScale(d.body_wt))
                        .attr('width', plotWidth/data.length)
                        .style('fill', colorScale(d.pred))
            })
        });

    </script>
</body>
</html>
